<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Global Temperatures Scatterplot</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .axis path,
    .axis line {fill: none; stroke: #000;
    }
    .axis text {font-size: 12px; }
  </style>
</head>
<body>
  <h2>Global Temperatures Over Time</h2>
  <div id="scatterplot_1" style="width: 800px; height: 500px;"></div>

  <script>
    async function Scatter() {

      // Load CSV
      const parseDate = d3.timeParse("%Y-%m-%d")
      const data = await d3.csv("GlobalTemperatures.csv", d => {
        return {
          time: parseDate(d.dt), 
          LAT: +d.LandAverageTemperature,
          LATU: +d.LandAverageTemperatureUncertainty,
          LOAT: +d.LandAndOceanAverageTemperature,
          LOATU: +d.LandAndOceanAverageTemperatureUncertainty
        };
      });
    console.log(data);
    console.log(data[0]);
    console.log(d3.extent(data, d => d.time));
    
      const margin = {top: 20, right: 30, bottom: 50, left: 60};
      const width = 800 - margin.left - margin.right;
      const height = 500 - margin.top - margin.bottom;

      const svg = d3.select("#scatterplot_1")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);


      // X scale
      const cxScale = d3.scaleTime()
        .domain(d3.extent(data, d => d.time))
        .range([0, width]);

      // Y scale
      const cyScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d.LAT))
        .nice()
        .range([height, 0]);

      // Radius scale
      const rScale = d3.scaleSqrt()
        .domain(d3.extent(data, d => d.LOATU))
        .range([10, 20]);

      // Color scale
      const colorScale = d3.scaleSequential(d3.interpolateTurbo)
        .domain(d3.extent(data, d => d.LOAT));

      // Draw circles
      svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
          .attr("r", d => rScale(d.LOATU))
          .attr("fill", d => colorScale(d.LOAT))
          .attr("opacity", 0.7)
          .attr("stroke", "black")
          .attr("stroke-width", 0.2);
      //Update cx and cy
      svg.selectAll("circle")
      .attr("cx", function(d) { return cxScale(d.time); })
      .attr("cy", function(d) { return cyScale(d.LAT); });

     // X label
svg.append("text")
  .attr("x", width / 2)
  .attr("y", height + 40)  // slightly below x-axis
  .attr("text-anchor", "middle")
  .style("font-size", "14px")
  .text("Date");

// Y label
svg.append("text")
  .attr("transform", "rotate(-90)")
  .attr("x", -height / 2)
  .attr("y", -50)  // left of y-axis
  .attr("text-anchor", "middle")
  .style("font-size", "14px")
  .text("Land Average Temperature (Â°C)");

    }
    Scatter();
  </script>
</body>
</html>
